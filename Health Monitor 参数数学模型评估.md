# Health Monitor 参数数学模型评估

## 1. 评估背景与目标
基于 `All_Contracts_Parameters.md` 中定义的最新协议参数（50天周期、2%基础日收益等）与 `HealthController` 的默认配置，通过数学模型推演在不同偿付率（Solvency Ratio）下的系统行为，评估现行风控参数的有效性与合理性。

### 核心输入参数
*   **投资周期**: 50 天
*   **日化收益**: 2% (本金释放) + 1%~2% (净利) = 3%~4% 总日化
*   **总期望回报 (ROI)**: 150% ~ 200% (50天)
*   **管理费 (Admin Fee)**: 5% (入金时扣除 5% 进 Treasury，出金时扣除 5% 进 Treasury)
    *   *注: 文档中 adminFeeBps=500，代码中 deposit/withdraw 双向收取。*

---

## 2. Health Monitor 参数现状

当前 5 档模式配置如下：

| 模式 | 触发阈值 (偿付率) | Reserve Fee (留存费) | Min Withdraw | Daily Limit |
| :--- | :--- | :--- | :--- | :--- |
| **Normal** | ≥ 80% | 2% | 1 U | ∞ (0) |
| **Watch** | 60% ~ 80% | 5% | 20 U | 800 U |
| **Throttle** | 40% ~ 60% | 10% | 50 U | 400 U |
| **Stabilize** | 20% ~ 40% | 20% | 100 U | 100 U |
| **Emergency** | < 20% | 50% | 500 U | 1 U (几乎暂停) |

---

## 3. 数学模型推演

### 3.1 偿付率 (Solvency Ratio) 定义
$$ \text{Solvency} = \frac{\text{Contract Balance}}{\text{Total Estimated Obligation}} $$
*   **Obligation (负债)**: 用户未来可提取的本金 + 利润总和。
*   **模型假设**: 
    *   平均日化 3.5% (Tier 2/3 用户为主)。
    *   平均 ROI = 175%。
    *   用户入金 100 U，协议负债瞬间变为 175 U。
    *   协议收到 95 U (扣除 5% 入金 Admin Fee)。
    *   **初始偿付率**: $95 / 175 \approx 54.2\%$。

### 3.2 初始偿付率悖论与修正
**发现问题**: 
按照上述公式，新项目刚启动（只有入金，没有出金）时，偿付率仅为 **54.2%**。
这意味着项目一上线就会直接进入 **Throttle (限流)** 模式 (40%~60%)，导致用户提现被限额 400 U 且扣除 10% 留存费。

**这显然是不合理的。**

**修正逻辑 (Reality Check)**:
Health Monitor 的设计初衷是监控“可兑付能力”，但对于高 ROI 项目，负债是“未来 50 天逐步释放”的，而资金是“现在在手”的。
*   **静态负债 vs 动态现金流**: 直接用总负债做分母会过于严苛。
*   **建议调整**: 
    1.  **调整阈值体系**: 承认 50%~60% 是常态，将 Normal 线大幅下调。
    2.  **调整计算公式**: 分母改为 `Total Principal` (总本金) 或 `Released Obligation` (已释放负债)。
    3.  **维持现状但依赖新进资金**: 必须依靠源源不断的入金来推高 Balance，或者依靠 ReserveVault 注入。

**基于“庞氏/互助模型”的特性，偿付率 < 100% 是数学必然。** 
若坚持使用 `Balance / Obligation` 公式，则 **Normal 阈值必须下调**。

---

## 4. 参数合理性评估与优化建议

### 4.1 针对“初始偿付率低”的优化方案

**方案 A：下调阈值 (推荐)**
承认 ROI 175% 模型下，55% 左右是“满血状态”。
*   **Normal**: ≥ 50%
*   **Watch**: 40% ~ 50%
*   **Throttle**: 30% ~ 40%
*   **Stabilize**: 15% ~ 30%
*   **Emergency**: < 15%

**方案 B：调整负债计算权重**
在计算 Obligation 时，对“未释放利润”打折。
*   `Effective Obligation = Principal + (Unreleased Interest * 0.5)`
*   这需要修改合约逻辑 (HealthController.sol)，成本较高。

**结论**: 建议采用 **方案 A**，直接调整 `All_Contracts_Parameters.md` 和 `HealthController` 配置中的阈值，无需改代码。

### 4.2 Reserve Fee (留存费) 的数学影响

*   **Normal (2%)**: 加上出金 Admin Fee 5%，用户实际到手损耗 7%。
    *   用户预期日化 3.5%，约等于 2 天的收益被磨损。**合理**。
*   **Watch (5%)**: 总损耗 10%。
    *   相当于 3 天收益。**有一定痛感，能抑制非必要提现**。
*   **Throttle (10%)**: 总损耗 15%。
    *   相当于 4-5 天收益。**强抑制作用**。
*   **Stabilize (20%)**: 总损耗 25%。
    *   相当于 1 周收益。**此时用户只会在极度恐慌时割肉离场，符合“保命”定位**。

**评估**: Reserve Fee 的梯度设置（2% -> 5% -> 10% -> 20%）是**非常科学且合理的**。

### 4.3 提现限额 (Daily Limit) 的压力测试

假设大户持有 10,000 U 活跃本金 (Tier 4)，日收益 4% = 400 U。

*   **Normal**: 无限制。-> 可全提。
*   **Watch**: 限额 800 U。-> 400 U 收益可全提。**对大户无感，仅限制本金撤离**。
*   **Throttle**: 限额 400 U。-> 400 U 收益刚好可提。**限制了大户复利后的膨胀提现**。
*   **Stabilize**: 限额 100 U。-> 只能提 1/4 收益。**强制大户复投或留存**。

**评估**: 
*   `Daily Limit` 对大户的限制在 **Throttle** 阶段才开始显现。
*   建议在 **Watch** 阶段适当降低限额（如从 800 U 降至 500-600 U），让预警期更有“痛感”。

---

## 5. 最终推荐参数集 (Revised Configuration)

基于 **50 天 / 175% ROI** 模型，修正后的 Health Monitor 建议参数：

### 5.1 修正后的模式阈值 (Thresholds)
*因初始偿付率仅约 55%，旧阈值 (80%) 会导致项目无法启动。*

| 模式 | 旧阈值 | **新建议阈值** | 逻辑理由 |
| :--- | :--- | :--- | :--- |
| **Normal** | ≥ 80% | **≥ 50%** | 匹配 ROI 175% 下的理论满血状态 (100/175 ≈ 57%) |
| **Watch** | 60%~80% | **40% ~ 50%** | 资金池开始轻微净流出 |
| **Throttle** | 40%~60% | **30% ~ 40%** | 资金池显著缩水，需启动保护 |
| **Stabilize** | 20%~40% | **15% ~ 30%** | 濒临枯竭，强力保命 |
| **Emergency** | < 20% | **< 15%** | 熔断 |

### 5.2 修正后的模式参数 (Mode Params)

| 模式 | Reserve Fee | Min Withdraw | Daily Limit | 调整说明 |
| :--- | :--- | :--- | :--- | :--- |
| **Normal** | 2% | 1 U | 0 (无限制) | 保持不变 |
| **Watch** | 5% | 20 U | **600 U** | 稍微收紧限额 (原 800)，让大户稍微感到挤压 |
| **Throttle** | 10% | 50 U | **300 U** | 进一步收紧 (原 400)，限制 Tier 4 大户的日收益全提 |
| **Stabilize** | 20% | 100 U | 100 U | 保持不变 |
| **Emergency** | 50% | 500 U | 1 U | 保持不变 |

---

## 6. 总结

1.  **原参数最大风险**: `Normal` 阈值定在 80% 太高，对于高 ROI 项目，**上线即限流**，用户体验极差。
2.  **核心调整**: 必须将 `Normal` 阈值下调至 **50%** 左右，以适配 175% ROI 的数学模型。
3.  **微调建议**: `Watch` 和 `Throttle` 的每日限额建议微调，以更精准地打击大户的“获利出逃”行为。

此评估文档可作为后续参数配置 (`setThresholds`, `setModeParams`) 的执行依据。
